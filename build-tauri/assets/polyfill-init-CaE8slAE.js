console.log("🌟 [POLYFILL-INIT] Initializing early WASM polyfills...");const l=typeof window<"u",n=typeof TextEncoder<"u";console.log("🌟 [POLYFILL-INIT] Environment - isClient:",l,"hasTextEncoder:",n);n&&!TextEncoder.prototype.encodeInto?(console.log("🌟 [POLYFILL-INIT] Applying TextEncoder.encodeInto polyfill"),TextEncoder.prototype.encodeInto=function(o,e){console.log("🌟 [POLYFILL-INIT] encodeInto polyfill called - source:",o.length,"dest:",e.length);const t=this.encode(o),i=Math.min(t.length,e.length);return e.set(t.subarray(0,i)),{read:o.length,written:i}},console.log("🌟 [POLYFILL-INIT] TextEncoder.encodeInto polyfill applied successfully")):console.log(n?"🌟 [POLYFILL-INIT] TextEncoder.encodeInto already available":"🌟 [POLYFILL-INIT] TextEncoder not available in this environment");l&&(console.log("🌟 [POLYFILL-INIT] Applying client-side polyfills..."),!window.TextEncoder&&n&&(console.log("🌟 [POLYFILL-INIT] Adding TextEncoder to window global"),window.TextEncoder=TextEncoder),!window.TextDecoder&&typeof TextDecoder<"u"&&(console.log("🌟 [POLYFILL-INIT] Adding TextDecoder to window global"),window.TextDecoder=TextDecoder),window.URL?console.log("🌟 [POLYFILL-INIT] URL already available globally"):(console.log("🌟 [POLYFILL-INIT] URL not available on window, checking global"),typeof URL<"u"?(console.log("🌟 [POLYFILL-INIT] Adding URL to window global"),window.URL=URL):console.log("🌟 [POLYFILL-INIT] URL not available anywhere - this should not happen in modern browsers")),(!window.crypto||!window.crypto.getRandomValues)&&(console.log("🌟 [POLYFILL-INIT] Adding crypto.getRandomValues polyfill"),window.crypto||(window.crypto={}),window.crypto.getRandomValues||(window.crypto.getRandomValues=function(o){console.log("🌟 [POLYFILL-INIT] crypto.getRandomValues polyfill called for array length:",o.length);for(let e=0;e<o.length;e++)o[e]=Math.floor(Math.random()*256);return o})),(!window.performance||!window.performance.now)&&(console.log("🌟 [POLYFILL-INIT] Adding performance.now polyfill"),window.performance||(window.performance={}),window.performance.now=function(){return Date.now()}),console.log("🌟 [POLYFILL-INIT] Client-side polyfills complete"));n&&console.log("🌟 [POLYFILL-INIT] Final verification - TextEncoder.encodeInto available:",!!TextEncoder.prototype.encodeInto);console.log("✅ [POLYFILL-INIT] Early WASM polyfill initialization complete");function d(){const o=typeof TextEncoder<"u",e=o&&!!TextEncoder.prototype.encodeInto;return console.log("🔍 [POLYFILL-VERIFY] TextEncoder available:",o),console.log("🔍 [POLYFILL-VERIFY] encodeInto available:",e),o&&e}const c={isClient:l,hasTextEncoder:n,hasEncodeInto:n&&!!TextEncoder.prototype.encodeInto,timestamp:new Date().toISOString()};export{c as polyfillStatus,d as verifyPolyfills};
